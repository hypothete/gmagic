{"version":3,"sources":["utils/colors.js","actions/actionTypes.js","actions/commands.js","components/Canvas.js","components/CommandListItem.js","actions/activeCommand.js","components/CommandList.js","components/ColorPalette.js","components/PatternToggle.js","components/ToolsPalette.js","actions/drawingMode.js","actions/modal.js","components/ExportModal.js","components/App.js","serviceWorker.js","store/initialState.js","reducers/index.js","reducers/commands.js","reducers/activeCommand.js","reducers/drawingMode.js","reducers/modal.js","store/index.js","index.js"],"names":["hex","ADD_COMMAND","REMOVE_COMMAND","MOVE_COMMAND_UP","MOVE_COMMAND_DOWN","MOVE_POINT","ADD_POINT","REMOVE_POINT","SET_COLOR","NAME_COMMAND","SET_PATTERN","ADD_BACKGROUND","SET_COMMANDS","MOVE_COMMAND","COPY_COMMAND","CHANGE_COMMAND_TYPE","SET_ACTIVE_COMMAND","SET_DRAWING_MODE","OPEN_MODAL","CLOSE_MODAL","commandCount","CanvasFrame","styled","div","_templateObject","ZoomCtrls","_templateObject2","props","dragging","PixelCanvas","canvas","_templateObject3","scale","clamp","val","min","max","Math","Canvas","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","renderCanvas","bind","assertThisInitialized","handleMouseDown","handleMouseMove","handleMouseUp","handleClick","handleContextMenu","zoomIn","zoomOut","state","dragIndex","movingPoints","lastX","lastY","refs","width","height","ctx","getContext","nextProps","setState","x","y","colors","pattern","pf","fillStyle","fillRect","x0","y0","x1","y1","e2","dx","abs","dy","sx","sy","err","loopCt","console","error","concat","fillPattern","pts","polyCorners","length","polyX","polyY","h","push","bresenham","nodeX","nodes","j","i","round","k","swap","l","_this2","clearRect","activeCmd","commands","activeCommand","toConsumableArray","forEach","cmd","type","polygon","points","id","globalCompositeOperation","strokeStyle","strokeRect","evt","rect","getBoundingClientRect","floor","clientX","left","clientY","top","a","b","pow","_this3","xy","convert","find","someCmd","nearest","pt","dist","stopPropagation","preventDefault","drawingMode","_this$convert","addPoint","_this$convert2","getNearestPoint","_this$convert3","movePoint","_this$convert4","moveCommand","_this$convert5","react_default","createElement","key","onMouseUp","onMouseMove","ref","onMouseDown","onClick","onContextMenu","role","aria-label","Component","connect","types","payload","index","removePoint","typeToEmoji","LINE","POLYGON","ListEntry","CommandListItem_templateObject","active","EntryCtrls","CommandListItem_templateObject2","EntryText","CommandListItem_templateObject3","CommandEdits","_templateObject4","EntrySwatch","_templateObject5","color","EntrySwatches","_templateObject6","CommandListItem","selectItem","moveUp","moveDown","remove","handleNameChange","copy","change","item","setActiveCommand","moveCommandUp","moveCommandDown","copyCommand","changeCommandType","removeCommand","nameCommand","target","value","_this$props","name","onChange","title","mapDispatchToProps","command","objectSpread","StyledList","CommandList_templateObject","CommandList","map","components_CommandListItem","PaletteWrap","ColorPalette_templateObject","Swatch","ColorPalette_templateObject2","ColorPalette","activeIndex","setColor","col","colorIndex","Wrap","PatternToggle_templateObject","Check","input","PatternToggle_templateObject2","PatternToggle","values","toggleValue","setPattern","valIndex","checked","ToolsWrap","ToolsPalette_templateObject","ToolsColumn","ToolsPalette_templateObject2","ToolButton","button","ToolsPalette_templateObject3","ToolRow","ToolsPalette_templateObject4","ToolsPalette","addCommand","setDrawingMode","addBackground","openModal","href","rel","react","components_ColorPalette","components_PatternToggle","mode","Overlay","ExportModal_templateObject","ModalWindow","ExportModal_templateObject2","Header","ExportModal_templateObject3","Body","ExportModal_templateObject4","ExitButton","ExportModal_templateObject5","ExportModal","exitModal","importFile","reader","FileReader","onload","loadevt","data","JSON","parse","result","setCommands","closeModal","readAsText","files","count","v","w","cmds","str","hexCol","patternData","calculatePattern","join","toString","modalOpen","jsonBlob","Blob","stringify","picoBlob","compressToPico","jsonUrl","window","URL","createObjectURL","picoUrl","download","Row","App_templateObject","App_templateObject2","App","App_Wrap","components_Canvas","components_CommandList","components_ToolsPalette","components_ExportModal","Boolean","location","hostname","match","initialState","combineReducers","arguments","undefined","action","filter","comm","foundCmdIndex","findIndex","foundCmd","slice","_action$payload","idx","_action$payload2","_action$payload3","splice","_action$payload4","someCol","someIndex","_action$payload5","_action$payload6","_action$payload7","newCmd","createStore","rootReducer","__REDUX_DEVTOOLS_EXTENSION__","rootElement","document","getElementById","ReactDOM","render","es","store","components_App","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.d9d091ec.chunk.js","sourcesContent":["// PICO-8 Colors\r\n\r\nexport const hex = [\r\n  '#000000', // black\r\n  '#1D2B53', // dark blue\r\n  '#7E2553', // purple\r\n  '#008751', // dark green\r\n  '#AB5236', // brown\r\n  '#5F574F', // dark gray\r\n  '#C2C3C7', // light gray\r\n  '#FFF1E8', // white\r\n  '#FF004D', // red\r\n  '#FFA300', // orange\r\n  '#FFEC27', // yellow\r\n  '#00E436', // green\r\n  '#29ADFF', // blue\r\n  '#83769C', // indigo\r\n  '#FF77A8', // pink\r\n  '#FFCCAA'  // peach\r\n];\r\n\r\nexport const rgb = [\r\n  [0, 0, 0],\r\n  [29, 43, 83],\r\n  [126, 37, 83],\r\n  [0, 135, 81],\r\n  [171, 82, 54],\r\n  [95, 87, 79],\r\n  [194, 195, 199],\r\n  [255, 241, 232],\r\n  [255, 0, 77],\r\n  [255, 163, 0],\r\n  [255, 236, 39],\r\n  [0, 228, 54],\r\n  [41, 173, 255],\r\n  [131, 118, 156],\r\n  [255, 119, 168],\r\n  [255, 204, 170]\r\n];","export const ADD_COMMAND = 'ADD_COMMAND';\r\nexport const REMOVE_COMMAND = 'REMOVE_COMMAND';\r\nexport const MOVE_COMMAND_UP = 'MOVE_COMMAND_UP';\r\nexport const MOVE_COMMAND_DOWN = 'MOVE_COMMAND_DOWN';\r\nexport const MOVE_POINT = 'MOVE_POINT';\r\nexport const ADD_POINT = 'ADD_POINT';\r\nexport const REMOVE_POINT = 'REMOVE_POINT';\r\nexport const SET_COLOR = 'SET_COLOR';\r\nexport const NAME_COMMAND = 'NAME_COMMAND';\r\nexport const SET_PATTERN = 'SET_PATTERN';\r\nexport const ADD_BACKGROUND = 'ADD_BACKGROUND';\r\nexport const SET_COMMANDS = 'SET_COMMANDS';\r\nexport const MOVE_COMMAND = 'MOVE_COMMAND';\r\nexport const COPY_COMMAND = 'COPY_COMMAND';\r\nexport const CHANGE_COMMAND_TYPE = 'CHANGE_COMMAND_TYPE';\r\n\r\nexport const SET_ACTIVE_COMMAND = 'SET_ACTIVE_COMMAND';\r\n\r\nexport const SET_DRAWING_MODE = 'SET_DRAWING_MODE';\r\n\r\nexport const OPEN_MODAL = 'OPEN_MODAL';\r\nexport const CLOSE_MODAL = 'CLOSE_MODAL';","import * as types from './actionTypes';\r\n\r\nlet commandCount = 0;\r\n\r\nexport function addCommand(type) {\r\n  return {\r\n    type: types.ADD_COMMAND,\r\n    payload: {\r\n      type,\r\n      id: ++commandCount\r\n    }\r\n  };\r\n}\r\n\r\nexport function removeCommand(command) {\r\n  return {\r\n    type: types.REMOVE_COMMAND,\r\n    payload: command\r\n  }\r\n}\r\n\r\nexport function moveCommandUp(command) {\r\n  return {\r\n    type: types.MOVE_COMMAND_UP,\r\n    payload: command\r\n  }\r\n}\r\n\r\nexport function moveCommandDown(command) {\r\n  return {\r\n    type: types.MOVE_COMMAND_DOWN,\r\n    payload: command\r\n  }\r\n}\r\n\r\nexport function movePoint(id, index, x, y) {\r\n  return {\r\n    type: types.MOVE_POINT,\r\n    payload: { id, index, x, y }\r\n  };\r\n}\r\n\r\nexport function addPoint(id, x, y) {\r\n  return {\r\n    type: types.ADD_POINT,\r\n    payload: { id, x, y }\r\n  };\r\n}\r\n\r\nexport function removePoint(id, index) {\r\n  return {\r\n    type: types.REMOVE_POINT,\r\n    payload: { id, index }\r\n  };\r\n}\r\n\r\nexport function setColor(id, color, index) {\r\n  return {\r\n    type: types.SET_COLOR,\r\n    payload: { id, color, index }\r\n  };\r\n}\r\n\r\nexport function nameCommand(id, name) {\r\n  return {\r\n    type: types.NAME_COMMAND,\r\n    payload: {id, name}\r\n  }\r\n}\r\n\r\nexport function setPattern(id, pattern) {\r\n  return {\r\n    type: types.SET_PATTERN,\r\n    payload: {id, pattern}\r\n  }\r\n}\r\n\r\nexport function addBackground() {\r\n  return {\r\n    type: types.ADD_BACKGROUND,\r\n    payload: {\r\n      type: 'POLYGON',\r\n      id: ++commandCount\r\n    }\r\n  }\r\n}\r\n\r\nexport function setCommands(commands) {\r\n  return {\r\n    type: types.SET_COMMANDS,\r\n    payload: commands\r\n  }\r\n}\r\n\r\nexport function moveCommand(id, x, y) {\r\n  return {\r\n    type: types.MOVE_COMMAND,\r\n    payload: { id, x, y }\r\n  }\r\n}\r\n\r\nexport function copyCommand(command) {\r\n  return {\r\n    type: types.COPY_COMMAND,\r\n    payload: {\r\n      ...command,\r\n      name: command.name + '-copy',\r\n      id: ++commandCount\r\n    }\r\n  }\r\n}\r\n\r\nexport function changeCommandType(id) {\r\n  return {\r\n    type: types.CHANGE_COMMAND_TYPE,\r\n    payload: id\r\n  }\r\n}","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {hex} from '../utils/colors';\r\n\r\nimport {addPoint, movePoint, removePoint, moveCommand} from '../actions/commands';\r\n\r\nconst CanvasFrame = styled.div`\r\n  position: relative;\r\n  flex: 1;\r\n  height: 100%;\r\n  overflow: scroll;\r\n  display: flex;\r\n  justify-content: flex-start;\r\n  align-items: flex-start;\r\n  background-color: darkgray;\r\n  margin-right: 10px;\r\n`;\r\n\r\nconst ZoomCtrls = styled.div`\r\n  position: absolute;\r\n  display: ${props => props.dragging ? 'none' : 'block' };\r\n  z-index: 3;\r\n  left: 10px;\r\n  top: 10px;\r\n`;\r\n\r\nconst PixelCanvas = styled.canvas`\r\n  width: ${props => props.scale}px;\r\n  height: ${props => props.scale}px;\r\n  image-rendering: optimizeSpeed;\r\n  image-rendering: -moz-crisp-edges;\r\n  image-rendering: -webkit-optimize-contrast;\r\n  image-rendering: optimize-contrast;\r\n  image-rendering: pixelated;\r\n  -ms-interpolation-mode: nearest-neighbor;\r\n  z-index: 1;\r\n  background-color: white;\r\n  flex-shrink: 0;\r\n  margin: 50px;\r\n  box-shadow: 0px 10px 20px rgba(0,0,0,0.2);\r\n`;\r\n\r\nfunction clamp(val, min, max) {\r\n  return Math.max(Math.min(max, val), min);\r\n}\r\n\r\nclass Canvas extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.renderCanvas = this.renderCanvas.bind(this);\r\n    this.handleMouseDown = this.handleMouseDown.bind(this);\r\n    this.handleMouseMove = this.handleMouseMove.bind(this);\r\n    this.handleMouseUp = this.handleMouseUp.bind(this);\r\n    this.handleClick = this.handleClick.bind(this);\r\n    this.handleContextMenu = this.handleContextMenu.bind(this);\r\n    this.zoomIn = this.zoomIn.bind(this);\r\n    this.zoomOut = this.zoomOut.bind(this);\r\n\r\n    this.state = {\r\n      dragIndex: -1,\r\n      movingPoints: false,\r\n      scale: 512,\r\n      lastX: 0,\r\n      lastY: 0\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.refs.canvas.width = 128;\r\n    this.refs.canvas.height = 128;\r\n    this.ctx = this.refs.canvas.getContext('2d');\r\n    this.renderCanvas(this.props);\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    this.renderCanvas(nextProps);\r\n  }\r\n\r\n  zoomIn() {\r\n    this.setState({\r\n      scale: this.state.scale * 2\r\n    });\r\n  }\r\n\r\n  zoomOut() {\r\n    this.setState({\r\n      scale: this.state.scale / 2\r\n    });\r\n  }\r\n\r\n  fillPattern(x, y, colors, pattern) {\r\n    const px = x % 4;\r\n    const py = y % 4;\r\n    const pc = py * 4 + px;\r\n    const pf = pattern[pc];\r\n    this.ctx.fillStyle = hex[colors[pf ? 1 : 0]];\r\n    this.ctx.fillRect(x, y,1,1);\r\n  }\r\n\r\n  // based on http://members.chello.at/~easyfilter/bresenham.html\r\n  bresenham(x0, y0, x1, y1, colors, pattern) {\r\n    const dx = Math.abs(x1 - x0);\r\n    const dy = -Math.abs(y1 - y0);\r\n    const sx = (x0 < x1) ? 1 : -1;\r\n    const sy = (y0 < y1) ? 1 : -1;\r\n    let x = x0, y = y0;\r\n    let err = dx + dy;\r\n    let e2;\r\n    let loopCt = 0;\r\n    do {\r\n      loopCt++;\r\n      if (loopCt > 500) {\r\n        console.error(`error drawing line ${x0}, ${y0} to ${x1}, ${y1}`);\r\n        break;\r\n      }\r\n      this.fillPattern(x,y, colors, pattern);\r\n      if ((x===x1) && (y===y1)) break;\r\n      e2 = 2 * err;\r\n      if (e2 >= dy) {\r\n        err += dy;\r\n        x += sx;\r\n      }\r\n      if (e2 <= dx) {\r\n        err += dx;\r\n        y += sy;\r\n      }\r\n    } while (true);\r\n  }\r\n\r\n  polygon(pts, colors, pattern) {\r\n    // http://alienryderflex.com/polygon_fill/\r\n    const polyCorners = pts.length / 2;\r\n    const polyX = [];\r\n    const polyY = [];\r\n    // sort out XY arrays\r\n    for (let h=0; h<pts.length; h+=2) {\r\n      polyX.push(pts[h]);\r\n      polyY.push(pts[h+1]);\r\n      if (h < pts.length-3) {\r\n        // fudge for scanline not working when y1 = y2\r\n        this.bresenham(pts[h], pts[h+1], pts[h+2], pts[h+3], colors, pattern);\r\n      }\r\n    }\r\n    //build node list\r\n    for (let y=0; y<this.refs.canvas.height; y++) {\r\n      const nodeX = [];\r\n      let nodes = 0;\r\n      let j = polyCorners - 1;\r\n      for (let i=0; i<polyCorners; i++) {\r\n        if (\r\n          ((polyY[i] < y) && (polyY[j] >= y)) ||\r\n          ((polyY[j] < y) && (polyY[i] >= y))\r\n        ) {\r\n          nodeX[nodes++] = (\r\n            polyX[i] +\r\n            Math.round((y-polyY[i])/(polyY[j]-polyY[i] + 0.0001) * // fudge for 0/0\r\n            (polyX[j] - polyX[i]))\r\n          );\r\n        }\r\n        j = i;\r\n      }\r\n      // sort nodes\r\n      let k=0;\r\n      while(k < nodes-1) {\r\n        if (nodeX[k] > nodeX[k+1]) {\r\n          let swap = nodeX[k];\r\n          nodeX[k] = nodeX[k+1];\r\n          nodeX[k+1] = swap;\r\n          if (k) k--;\r\n        }\r\n        else {\r\n          k++;\r\n        }\r\n      }\r\n      // fill the pixels between pairs\r\n      for (let l=0; l<nodes; l+=2) {\r\n        if (nodeX[l] >= this.refs.canvas.width) break;\r\n        if (nodeX[l+1] > 0) {\r\n          if (nodeX[l] < 0) nodeX[l] = 0;\r\n          if (nodeX[l+1] > this.refs.canvas.width) nodeX[l+1] = this.refs.canvas.width-1;\r\n          this.bresenham(nodeX[l], y, nodeX[l+1], y, colors, pattern);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  renderCanvas(props) {\r\n    this.ctx.clearRect(0, 0, this.refs.canvas.width, this.refs.canvas.height);\r\n    const {commands, activeCommand} = props;\r\n    const cmds = [...commands];//.reverse();\r\n    let activeCmd;\r\n    cmds.forEach(cmd => {\r\n      switch(cmd.type) {\r\n        case 'POLYGON': {\r\n          this.polygon(cmd.points, cmd.colors, cmd.pattern);\r\n          break;\r\n        }\r\n        case 'LINE': {\r\n          for (let i = 0; i < cmd.points.length-3; i+=2) {\r\n            const x0 = cmd.points[i];\r\n            const y0 = cmd.points[i+1];\r\n            const x1 = cmd.points[i+2];\r\n            const y1 = cmd.points[i+3];\r\n            this.bresenham(x0, y0, x1, y1, cmd.colors, cmd.pattern);\r\n          }\r\n          break;\r\n        }\r\n        default:\r\n          return;\r\n      }\r\n      if(cmd.id === activeCommand) {\r\n        activeCmd = cmd;\r\n      }\r\n    });\r\n    if(activeCmd) {\r\n      // draw points\r\n      this.ctx.globalCompositeOperation = 'xor';\r\n      this.ctx.strokeStyle = hex[activeCmd.colors[0]];\r\n      for (let i=0; i< activeCmd.points.length; i+=2) {\r\n        const x = activeCmd.points[i] - 0.5;\r\n        const y = activeCmd.points[i+1] - 0.5;\r\n        this.ctx.strokeRect(x, y, 2, 2);\r\n      }\r\n      this.ctx.globalCompositeOperation = 'source-over';\r\n    }\r\n  }\r\n\r\n  convert(evt) {\r\n    const rect = this.refs.canvas.getBoundingClientRect();\r\n    return {\r\n      x: clamp(Math.floor(this.refs.canvas.width * (evt.clientX - rect.left) / rect.width), 0, this.refs.canvas.width),\r\n      y: clamp(Math.floor(this.refs.canvas.height * (evt.clientY - rect.top) / rect.height), 0, this.refs.canvas.height)\r\n    };\r\n  }\r\n\r\n  dist (a, b) {\r\n    // squared distance - one less operation\r\n    return Math.pow(b.x-a.x, 2) + Math.pow(b.y - a.y, 2);\r\n  }\r\n\r\n  getNearestPoint(evt) {\r\n    const xy = this.convert(evt);\r\n    const cmd = this.props.commands.find(someCmd => someCmd.id === this.props.activeCommand);\r\n    // check dist to points\r\n    let nearest = -1;\r\n    for(let i=0; i < cmd.points.length; i+=2) {\r\n      const pt = {\r\n        x: cmd.points[i],\r\n        y: cmd.points[i+1]\r\n      };\r\n      const dist = this.dist(pt, xy);\r\n      if (dist < 8) {\r\n        nearest = i;\r\n        break;\r\n      }\r\n    }\r\n    return nearest;\r\n  }\r\n\r\n  handleClick(evt) {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    if (this.props.activeCommand === null) return;\r\n    if (this.props.drawingMode !== 'ADD_POINTS') return;\r\n    // add point\r\n    const { x, y } = this.convert(evt);\r\n    this.props.addPoint(this.props.activeCommand, x, y);\r\n  }\r\n\r\n  handleMouseDown(evt) {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    if (this.props.activeCommand === null) return;\r\n    if (this.props.drawingMode === 'MOVE_POINTS') {\r\n      const {x, y} = this.convert(evt);\r\n      this.setState({\r\n        movingPoints: true,\r\n        lastX: x,\r\n        lastY: y\r\n      });\r\n    }\r\n    else if (this.props.drawingMode === 'EDIT_POINTS') {\r\n      const nearest = this.getNearestPoint(evt);\r\n      if (nearest >= 0) {\r\n        // found a point\r\n        this.setState({\r\n          dragIndex: nearest\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  handleMouseMove(evt) {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    if (this.props.activeCommand === null) return;\r\n    if (this.props.drawingMode === 'EDIT_POINTS' && this.state.dragIndex >= 0) {\r\n      // move selected point\r\n      const {x, y} = this.convert(evt);\r\n      this.props.movePoint(this.props.activeCommand, this.state.dragIndex, x, y);\r\n    }\r\n    else if (this.props.drawingMode === 'MOVE_POINTS' && this.state.movingPoints) {\r\n      const {x, y} = this.convert(evt);\r\n      const dx = x - this.state.lastX;\r\n      const dy = y - this.state.lastY;\r\n      this.props.moveCommand(this.props.activeCommand, dx, dy);\r\n      this.setState({\r\n        lastX: x,\r\n        lastY: y\r\n      });\r\n    }\r\n  }\r\n\r\n  handleMouseUp(evt) {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    const {x, y} = this.convert(evt);\r\n    this.setState({\r\n      dragIndex: -1,\r\n      movingPoints: false,\r\n      lastX: x,\r\n      lastY: y\r\n    });\r\n  }\r\n\r\n  handleContextMenu(evt) {\r\n    evt.stopPropagation();\r\n    evt.preventDefault();\r\n    return false;\r\n  }\r\n\r\n  render() {\r\n    return [\r\n      <CanvasFrame key=\"frame\" onMouseUp={this.handleMouseUp} onMouseMove={this.handleMouseMove}>\r\n        <PixelCanvas scale={this.state.scale} ref=\"canvas\"\r\n          onMouseDown={this.handleMouseDown}\r\n          onClick={this.handleClick}\r\n          onContextMenu={this.handleContextMenu}\r\n        ></PixelCanvas>\r\n      </CanvasFrame>,\r\n      <ZoomCtrls key=\"ctrls\" dragging={this.state.dragIndex > -1}>\r\n        <button onClick={this.zoomIn}><span role=\"img\" aria-label=\"zoom in\">‚ûï</span></button>\r\n        <button onClick={this.zoomOut}><span role=\"img\" aria-label=\"zoom out\">‚ûñ</span></button>\r\n      </ZoomCtrls>\r\n    ];\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    commands: state.commands,\r\n    activeCommand: state.activeCommand,\r\n    drawingMode: state.drawingMode\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, {addPoint, movePoint, removePoint, moveCommand})(Canvas);\r\n","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {setActiveCommand} from '../actions/activeCommand';\r\nimport {moveCommandUp, moveCommandDown, removeCommand, nameCommand, copyCommand, changeCommandType} from '../actions/commands';\r\n\r\nimport {hex} from '../utils/colors';\r\n\r\nconst typeToEmoji = {\r\n  'LINE': '‚úíÔ∏è',\r\n  'POLYGON': '‚≠ê'\r\n};\r\n\r\nconst ListEntry = styled.div`\r\n  width: 100%;\r\n  border-bottom: 2px outset;\r\n  padding: 10px;\r\n  background-color: ${props => props.active ? 'darkgray' : 'white'}\r\n  display: flex;\r\n  justify-content: flex-end;\r\n`;\r\n\r\nconst EntryCtrls = styled.div`\r\n  display: flex;\r\n  height: 100%;\r\n  width: 3em;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-right: 5px;\r\n`;\r\n\r\nconst EntryText = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-right: 10px;\r\n  flex: 1;\r\n  height: 50%;\r\n`;\r\n\r\nconst CommandEdits = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  flex: 1;\r\n  justify-content: center;\r\n  margin: 5px;\r\n`;\r\n\r\nconst EntrySwatch = styled.div`\r\n  width: 1em;\r\n  height: 1em;\r\n  display: inline-block;\r\n  background-color: ${props => props.color};\r\n  border: 2px inset;\r\n`;\r\n\r\nconst EntrySwatches = styled.div`\r\n  width: 3em;\r\n  height: 3em;\r\n  margin: 5px;\r\n`;\r\n\r\nclass CommandListItem extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.selectItem = this.selectItem.bind(this);\r\n    this.moveUp = this.moveUp.bind(this);\r\n    this.moveDown = this.moveDown.bind(this);\r\n    this.remove = this.remove.bind(this);\r\n    this.handleNameChange = this.handleNameChange.bind(this);\r\n    this.copy = this.copy.bind(this);\r\n    this.change = this.change.bind(this);\r\n  }\r\n\r\n  selectItem() {\r\n    if (!(this.props.activeCommand === this.props.item.id)) {\r\n      this.props.setActiveCommand(this.props.item);\r\n    }\r\n    else {\r\n      this.props.setActiveCommand({ id: null });\r\n    }\r\n  }\r\n\r\n  moveUp(evt) {\r\n    evt.stopPropagation();\r\n    this.props.moveCommandUp(this.props.item);\r\n  }\r\n\r\n  moveDown(evt) {\r\n    evt.stopPropagation();\r\n    this.props.moveCommandDown(this.props.item);\r\n  }\r\n\r\n  copy(evt) {\r\n    evt.stopPropagation();\r\n    this.props.copyCommand(this.props.item);\r\n  }\r\n\r\n  change(evt) {\r\n    evt.stopPropagation();\r\n    this.props.changeCommandType(this.props.item.id);\r\n  }\r\n\r\n  remove(evt) {\r\n    evt.stopPropagation();\r\n    this.props.removeCommand(this.props.item);\r\n  }\r\n\r\n  handleNameChange(evt) {\r\n    this.props.nameCommand(this.props.item.id, evt.target.value);\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      item,\r\n      activeCommand\r\n    } = this.props;\r\n    return (\r\n      <ListEntry\r\n        onClick={this.selectItem}\r\n        active={activeCommand === item.id}\r\n      >\r\n        <div>\r\n          <EntryText>\r\n            <span role=\"img\" aria-label={item.type}>{typeToEmoji[item.type]}</span>\r\n            <input type=\"text\" value={item.name} onChange={this.handleNameChange} />\r\n          </EntryText>\r\n          <CommandEdits>\r\n            <button onClick={this.copy} title=\"copy command\">\r\n              <span role=\"img\" aria-label=\"copy command\">‚úÇÔ∏è</span>\r\n            </button>\r\n            <button onClick={this.change} title=\"change command type\">\r\n              <span role=\"img\" aria-label=\"change command type\">‚ôªÔ∏è</span>\r\n            </button>\r\n            <button onClick={this.remove} title=\"remove command\">\r\n              <span role=\"img\" aria-label=\"remove command\">üóëÔ∏è</span>\r\n            </button>\r\n          </CommandEdits>\r\n        </div>\r\n        \r\n        <EntrySwatches>\r\n          <EntrySwatch color={hex[item.colors[0]]}></EntrySwatch>\r\n          <EntrySwatch color={hex[item.colors[1]]}></EntrySwatch>\r\n        </EntrySwatches>\r\n        <EntryCtrls>\r\n          <button onClick={this.moveUp} title=\"move command up\">\r\n            <span role=\"img\" aria-label=\"move command up\">üîº</span>\r\n          </button>\r\n          <button onClick={this.moveDown} title=\"move command down\">\r\n            <span role=\"img\" aria-label=\"move command down\">üîΩ</span>\r\n          </button>\r\n        </EntryCtrls>\r\n      </ListEntry>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    activeCommand: state.activeCommand\r\n  };\r\n}\r\n\r\nconst mapDispatchToProps = {\r\n  setActiveCommand,\r\n  moveCommandUp,\r\n  moveCommandDown,\r\n  removeCommand,\r\n  nameCommand,\r\n  copyCommand,\r\n  changeCommandType\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CommandListItem);\r\n","import * as types from './actionTypes';\r\n\r\nexport function setActiveCommand(command) {\r\n  return {\r\n    type: types.SET_ACTIVE_COMMAND,\r\n    payload: command.id\r\n  };\r\n}","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport CommandListItem from './CommandListItem';\r\n\r\nconst StyledList = styled.div`\r\n  border: 2px inset;\r\n  border-top: none;\r\n  width: 300px;\r\n  height: 100%;\r\n  overflow-y: scroll;\r\n  margin: 0 10px 0 0;\r\n  padding-top: 10px;\r\n`;\r\n\r\nclass CommandList extends Component {\r\n  render() {\r\n    const {commands} = this.props;\r\n    return (\r\n      <StyledList>\r\n        {\r\n          commands.map(cmd => (<CommandListItem key={cmd.id} item={cmd} />))\r\n        }\r\n      </StyledList>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    commands: state.commands\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps)(CommandList);\r\n","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {setColor} from '../actions/commands';\r\n\r\nimport {hex} from '../utils/colors';\r\n\r\nconst PaletteWrap = styled.div`\r\n  margin: 10px;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n`;\r\n\r\nconst Swatch = styled.div`\r\n  width: 20px;\r\n  height: 20px;\r\n  background-color: ${props => props.color};\r\n  border: 2px  ${props => props.active? 'dashed' : 'inset'};\r\n  border-color:  ${props => props.active? 'black' : 'auto'};\r\n`;\r\n\r\nclass ColorPalette extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      activeIndex: -1\r\n    };\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    const activeCmd = nextProps.commands.find(cmd => cmd.id === nextProps.activeCommand);\r\n    if (activeCmd) {\r\n      this.setState({\r\n        activeIndex: activeCmd.colors[nextProps.index]\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {activeCommand, setColor, index} = this.props;\r\n    return (\r\n      <PaletteWrap>\r\n        {\r\n          hex.map((col, colorIndex) =>(\r\n            <Swatch color={col} key={colorIndex} active={this.state.activeIndex === colorIndex}\r\n              onClick={() => {setColor(activeCommand, colorIndex, index)}}>\r\n            </Swatch>\r\n          ))\r\n        }\r\n      </PaletteWrap>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    activeCommand: state.activeCommand,\r\n    commands: state.commands\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, {setColor})(ColorPalette);\r\n","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {setPattern} from '../actions/commands';\r\n\r\nconst Wrap = styled.div`\r\n  width: 100px;\r\n  height: 100px;\r\n`;\r\n\r\nconst Check = styled.input`\r\n  width: 25%;\r\n  height: 25%;\r\n  float: left;\r\n  margin: 0;\r\n`;\r\n\r\nclass PatternToggle extends Component {\r\n  constructor(props){\r\n    super(props);\r\n\r\n    const activeCmd = props.commands.find(cmd => cmd.id === props.activeCommand);\r\n    if (activeCmd) {\r\n      this.state ={\r\n        values: [...activeCmd.pattern]\r\n      };\r\n    }\r\n    else {\r\n      this.state = {values:[\r\n        false, false, false, false,\r\n        false, false, false, false,\r\n        false, false, false, false,\r\n        false, false, false, false,\r\n      ]};\r\n    }\r\n    this.toggleValue = this.toggleValue.bind(this);\r\n  }\r\n  componentWillReceiveProps(nextProps) {\r\n    const activeCmd = nextProps.commands.find(cmd => cmd.id === nextProps.activeCommand);\r\n    if (activeCmd) {\r\n      this.setState({\r\n        values: [...activeCmd.pattern]\r\n      });\r\n    }\r\n  }\r\n  toggleValue(index) {\r\n    this.props.setPattern(this.props.activeCommand, this.state.values.map((val, valIndex) => {\r\n      if (valIndex === index) {\r\n        return !val;\r\n      }\r\n      return val;\r\n    }))\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Wrap>\r\n        {\r\n          this.state.values.map((value, index) => (\r\n            <Check type=\"checkbox\" key={index} checked={value} onChange={() => {this.toggleValue(index);}} />\r\n          ))\r\n        }\r\n      </Wrap>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    activeCommand: state.activeCommand,\r\n    commands: state.commands\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, {setPattern})(PatternToggle);\r\n","import React, { Component, Fragment } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {addCommand, addBackground} from '../actions/commands';\r\nimport {setDrawingMode} from '../actions/drawingMode';\r\n\r\nimport ColorPalette from './ColorPalette';\r\nimport PatternToggle from './PatternToggle';\r\nimport { openModal } from '../actions/modal';\r\n\r\nconst ToolsWrap = styled.div`\r\n  margin: 10px;\r\n  flex: 1;\r\n  min-height: 100px;\r\n  z-index: 2;\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: flex-start;\r\n  justify-content: space-between;\r\n  overflow-y: scroll;\r\n  padding: 0 10px;\r\n`;\r\n\r\nconst ToolsColumn = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n`;\r\n\r\nconst ToolButton = styled.button`\r\n  margin: 0px 5px 5px 5px;\r\n  border-width: 2px;\r\n  border-color: ${props => props.active ? 'blue' : 'none'};\r\n  cursor: pointer;\r\n`;\r\n\r\nconst ToolRow = styled.div`\r\n  min-height: 30px;\r\n`;\r\n\r\nclass ToolsPalette extends Component {\r\n\r\n  render() {\r\n    const {\r\n      addCommand,\r\n      activeCommand,\r\n      setDrawingMode,\r\n      drawingMode,\r\n      addBackground,\r\n      openModal\r\n      } = this.props;\r\n    return (\r\n      <ToolsWrap>\r\n        <ToolsColumn>\r\n          <ToolRow>\r\n          <ToolButton\r\n            onClick={() => {addCommand('LINE')}}>\r\n            <span role=\"img\" aria-label=\"add line\">‚úíÔ∏è Add Line</span>\r\n          </ToolButton>\r\n          <ToolButton\r\n            onClick={() => {addCommand('POLYGON')}}>\r\n            <span role=\"img\" aria-label=\"add polygon\">‚≠ê Add Polygon</span>\r\n          </ToolButton>\r\n          <ToolButton\r\n            onClick={() => {addBackground()}}>\r\n            <span role=\"img\" aria-label=\"add background\">üñºÔ∏è Add Background</span>\r\n          </ToolButton>\r\n          <ToolButton\r\n            onClick={() => {openModal()}} >\r\n            <span role=\"img\" aria-label=\"open export modal\">üíæ Import/Export</span>\r\n          </ToolButton>\r\n          <a href=\"//github.com/hypothete/gmagic\" target=\"_blank\" rel=\"noreferrer noopener\">\r\n            <ToolButton>\r\n              <span role=\"img\" aria-label=\"go to help readme\">‚ùì Help</span>\r\n            </ToolButton>\r\n          </a>\r\n          </ToolRow>\r\n          <ToolRow>\r\n          {\r\n            activeCommand !== null && (\r\n              <Fragment>\r\n                <ToolButton\r\n                  onClick={() => {setDrawingMode('ADD_POINTS')}} active={drawingMode === 'ADD_POINTS'}>\r\n                  <span role=\"img\" aria-label=\"add points\">‚ûï Add Points</span>\r\n                </ToolButton>\r\n                <ToolButton\r\n                  onClick={() => {setDrawingMode('EDIT_POINTS')}} active={drawingMode === 'EDIT_POINTS'}>\r\n                  <span role=\"img\" aria-label=\"edit points\">üìç Edit Points</span>\r\n                </ToolButton>\r\n                <ToolButton\r\n                  onClick={() => {setDrawingMode('MOVE_POINTS')}} active={drawingMode === 'MOVE_POINTS'}>\r\n                  <span role=\"img\" aria-label=\"move points\">üïπÔ∏è Move Points</span>\r\n                </ToolButton>\r\n              </Fragment>\r\n            )\r\n          }\r\n          </ToolRow>\r\n        </ToolsColumn>\r\n        <ToolsColumn>\r\n          <ColorPalette index={0}></ColorPalette>\r\n          <ColorPalette index={1}></ColorPalette>\r\n        </ToolsColumn>\r\n        <ToolsColumn>\r\n          <PatternToggle></PatternToggle>\r\n        </ToolsColumn>\r\n      </ToolsWrap>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    activeCommand: state.activeCommand,\r\n    drawingMode: state.drawingMode\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, {addCommand, addBackground, setDrawingMode, openModal})(ToolsPalette);\r\n","import * as types from './actionTypes';\r\n\r\nexport function setDrawingMode(mode) {\r\n  return {\r\n    type: types.SET_DRAWING_MODE,\r\n    payload: mode\r\n  };\r\n}","import * as types from './actionTypes';\r\n\r\nexport function openModal() {\r\n  return {\r\n    type: types.OPEN_MODAL\r\n  };\r\n}\r\n\r\nexport function closeModal() {\r\n  return {\r\n    type: types.CLOSE_MODAL\r\n  };\r\n}","import React, { Component } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport styled from 'styled-components';\r\n\r\nimport {closeModal} from '../actions/modal';\r\nimport {setCommands} from '../actions/commands';\r\n\r\nconst Overlay = styled.div`\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: rgba(0,0,0,0.5);\r\n  z-index: 5;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n`;\r\n\r\nconst ModalWindow = styled.div`\r\n  background-color: #fff;\r\n  box-shadow: 0px 10px 20px rgba(0,0,0,0.1);\r\n  cursor: auto;\r\n`;\r\n\r\nconst Header = styled.div`\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n  padding: 10px;\r\n\r\n  p {\r\n    margin: 0 10px 0 0;\r\n  }\r\n`;\r\n\r\nconst Body = styled.div`\r\n  padding: 10px;\r\n`;\r\n\r\nconst ExitButton = styled.div`\r\n  cursor: pointer;\r\n`;\r\n\r\nclass ExportModal extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.exitModal = this.exitModal.bind(this);\r\n    this.importFile = this.importFile.bind(this);\r\n  }\r\n\r\n  importFile(evt) {\r\n    const reader = new FileReader();\r\n    reader.onload = (loadevt) => {\r\n      const data = JSON.parse(loadevt.target.result);\r\n      this.props.setCommands(data);\r\n      this.props.closeModal();\r\n    };\r\n    reader.readAsText(evt.target.files[0]);\r\n  }\r\n\r\n  calculatePattern(values) {\r\n    let count = 0;\r\n    values.forEach((v, id) => {\r\n      let w = 0;\r\n      if (v && id > 0) {\r\n        w = Math.pow(2,15-id);\r\n      }\r\n      else if (v) {\r\n        w -= 32768;\r\n      }\r\n      count += w;\r\n    });\r\n    return count;\r\n  }\r\n\r\n  compressToPico(cmds) {\r\n    let str = 'function()\\n';\r\n    cmds.forEach(cmd => {\r\n      if (cmd.type === 'POLYGON') {\r\n        str += ' poly('\r\n      }\r\n      else if (cmd.type === 'LINE') {\r\n        str += ' pline('\r\n      }\r\n      let hexCol = (16 * cmd.colors[1] + cmd.colors[0]);\r\n      const patternData = this.calculatePattern(cmd.pattern);\r\n      str += `'${cmd.points.join(',')}', 0x${hexCol.toString(16)}, ${patternData})\\n`;\r\n    });\r\n    str += 'end\\n'\r\n    return str;\r\n  }\r\n\r\n  exitModal(evt) {\r\n    evt.stopPropagation();\r\n    this.props.closeModal();\r\n  }\r\n\r\n  render() {\r\n    const {commands, modalOpen} = this.props;\r\n    if (!modalOpen) return null;\r\n\r\n    const jsonBlob = new Blob([JSON.stringify(commands, null, 2)], { type: 'application/json' });\r\n    const picoBlob = new Blob([this.compressToPico(commands)], { type: 'text/plain' });\r\n    const jsonUrl = window.URL.createObjectURL(jsonBlob);\r\n    const picoUrl = window.URL.createObjectURL(picoBlob);\r\n\r\n    return (\r\n      <Overlay>\r\n        <ModalWindow>\r\n          <Header>\r\n            <p>\r\n              Import and export data\r\n            </p>\r\n            <ExitButton onClick={this.exitModal}><span role=\"img\" aria-label=\"exit modal button\">‚ùå</span></ExitButton>\r\n          </Header>\r\n          <Body>\r\n            <p>\r\n              Import JSON: <input type=\"file\" onChange={this.importFile} /> \r\n            </p>\r\n            <p>\r\n              <a download=\"gmagic_drawing.json\" href={jsonUrl}>Download JSON</a>\r\n            </p>\r\n            <p>\r\n              <a download=\"gmagic_drawing.txt\" href={picoUrl}>Download PICO-8 code</a>\r\n            </p>\r\n          </Body>\r\n        </ModalWindow>\r\n      </Overlay>\r\n    );\r\n  }\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    commands: state.commands,\r\n    modalOpen: state.modalOpen\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, {closeModal, setCommands})(ExportModal);\r\n","import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport styled from 'styled-components';\n\nimport Canvas from './Canvas';\nimport CommandList from './CommandList';\nimport ToolsPalette from './ToolsPalette';\nimport ExportModal from './ExportModal';\n\nconst Row = styled.div`\n  width: 100%;\n  height: 80vh;\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin: 0;\n`;\n\nconst Wrap = styled.div`\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  display: flex;\n  flex-direction: column;\n`;\n\nclass App extends Component {\n  render() {\n    return (\n      <Wrap>\n        <Row>\n          <Canvas></Canvas>\n          <CommandList></CommandList>\n        </Row>\n        <ToolsPalette></ToolsPalette>\n        <ExportModal />\n      </Wrap>\n    );\n  }\n}\n\nconst mapStateToProps = state => {\n  return {};\n}\n\nexport default connect(mapStateToProps)(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","export default {\r\n  commands: [\r\n    {\r\n      id: 12345,\r\n      name: 'Background',\r\n      type: 'POLYGON',\r\n      points: [\r\n        0, 0, 127, 0, 127, 127, 0, 127\r\n      ],\r\n      colors: [6,7],\r\n      pattern: [\r\n        true, true, false, false,\r\n        true, true, false, false,\r\n        false, false, true, true,\r\n        false, false, true, true\r\n      ]\r\n    }\r\n  ],\r\n  activeCommand: null,\r\n  drawingMode: 'EDIT_POINTS',\r\n  modalOpen: false\r\n}","import { combineReducers } from 'redux';\r\n\r\nimport commandsReducer from './commands';\r\nimport activeCommandReducer from './activeCommand';\r\nimport drawingModeReducer from './drawingMode'\r\nimport modalReducer from './modal';\r\n\r\nexport default combineReducers({\r\n  commands: commandsReducer,\r\n  activeCommand: activeCommandReducer,\r\n  drawingMode: drawingModeReducer,\r\n  modalOpen: modalReducer\r\n});\r\n","import initialState from '../store/initialState';\r\nimport * as types from '../actions/actionTypes';\r\n\r\nexport default function commandsReducer(state = initialState.commands, action) {\r\n  switch (action.type) {\r\n    \r\n    case types.ADD_COMMAND:\r\n      return [\r\n        ...state,\r\n        {\r\n          id: action.payload.id,\r\n          name: `cmd-${action.payload.id}`,\r\n          type: action.payload.type,\r\n          points: [],\r\n          colors: [0,7],\r\n          pattern: [\r\n            false, false, false, false,\r\n            false, false, false, false,\r\n            false, false, false, false,\r\n            false, false, false, false\r\n          ]\r\n        }\r\n      ];\r\n    \r\n    case types.REMOVE_COMMAND:\r\n      return [\r\n        ...state.filter(comm => comm.id !== action.payload.id)\r\n      ];\r\n\r\n      case types.ADD_BACKGROUND:\r\n      return [\r\n        {\r\n          id: action.payload.id,\r\n          name: `Background-${action.payload.id}`,\r\n          type: action.payload.type,\r\n          points: [0,0, 127,0, 127,127, 0,127],\r\n          colors: [7,0],\r\n          pattern: [\r\n            false, false, false, false,\r\n            false, false, false, false,\r\n            false, false, false, false,\r\n            false, false, false, false\r\n          ]\r\n        },\r\n        ...state\r\n      ];\r\n\r\n    case types.MOVE_COMMAND_UP: {\r\n      let foundCmdIndex = state.findIndex(cmd => cmd.id === action.payload.id);\r\n      if (foundCmdIndex <= 0) {\r\n        // if 0 nowhere to move up\r\n        return [...state];\r\n      }\r\n      let foundCmd = state[foundCmdIndex];\r\n      return [\r\n        ...state.slice(0, foundCmdIndex-1),\r\n        { ...foundCmd },\r\n        {...state[foundCmdIndex-1]},\r\n        ...state.slice(foundCmdIndex+1)\r\n      ];\r\n    }\r\n\r\n    case types.MOVE_COMMAND_DOWN: {\r\n      let foundCmdIndex = state.findIndex(cmd => cmd.id === action.payload.id);\r\n      if (foundCmdIndex <0 || foundCmdIndex === state.length-1) {\r\n        // if not found or furthest down ignore\r\n        return [...state];\r\n      }\r\n      let foundCmd = state[foundCmdIndex];\r\n      return [\r\n        ...state.slice(0, foundCmdIndex),\r\n        {...state[foundCmdIndex+1]},\r\n        { ...foundCmd },\r\n        ...state.slice(foundCmdIndex+2)\r\n      ];\r\n    }\r\n\r\n    case types.MOVE_POINT: {\r\n      const {id, index, x, y} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            points: cmd.points.map((pt, idx) => {\r\n              if (idx === index) {\r\n                return x;\r\n              }\r\n              else if(idx === index+1) {\r\n                return y;\r\n              }\r\n              return pt;\r\n            })\r\n          }\r\n        }\r\n        return cmd;\r\n      })\r\n    }\r\n\r\n    case types.ADD_POINT: {\r\n      const {id, x, y} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            points: [\r\n              ...cmd.points,\r\n              x,\r\n              y\r\n            ]\r\n          }\r\n        }\r\n        return cmd;\r\n      });\r\n    }\r\n\r\n    case types.REMOVE_POINT: {\r\n      const {id, index} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            points: cmd.points.splice(index, 2)\r\n          }\r\n        }\r\n        return cmd;\r\n      });\r\n    }\r\n\r\n    case types.SET_COLOR: {\r\n      const {id, color, index} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            colors: cmd.colors.map((someCol, someIndex) => {\r\n              if (index === someIndex) {\r\n                return color;\r\n              }\r\n              return someCol;\r\n            })\r\n          }\r\n        }\r\n        return cmd;\r\n      });\r\n    }\r\n\r\n    case types.NAME_COMMAND: {\r\n      const {id, name} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            name\r\n          }\r\n        }\r\n        return cmd;\r\n      });\r\n    }\r\n\r\n    case types.SET_PATTERN: {\r\n      const {id, pattern} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            pattern: [...pattern]\r\n          }\r\n        }\r\n        return cmd;\r\n      });\r\n    }\r\n\r\n    case types.SET_COMMANDS: {\r\n      // TODO: some command validation\r\n      return [\r\n        ...action.payload\r\n      ];\r\n    }\r\n\r\n    case types.MOVE_COMMAND: {\r\n      const {id, x, y} = action.payload;\r\n      return state.map(cmd => {\r\n        if (cmd.id === id) {\r\n          return {\r\n            ...cmd,\r\n            points: cmd.points.map((pt, index) => {\r\n              if (index % 2 === 0) {\r\n                // x\r\n                return pt + x;\r\n              }\r\n              else {\r\n                // y\r\n                return pt + y;\r\n              }\r\n            })\r\n          }\r\n        }\r\n        return cmd;\r\n      });\r\n    }\r\n\r\n    case types.COPY_COMMAND: {\r\n      const newCmd = action.payload;\r\n      return [\r\n        ...state,\r\n        newCmd\r\n      ];\r\n    }\r\n\r\n    case types.CHANGE_COMMAND_TYPE: {\r\n      return state.map(cmd => {\r\n        if (cmd.id === action.payload) {\r\n          return {\r\n            ...cmd,\r\n            type: cmd.type === 'POLYGON' ? 'LINE' : 'POLYGON'\r\n          };\r\n        }\r\n        return cmd;\r\n      })\r\n    }\r\n    \r\n    default:\r\n      return state;\r\n  }\r\n}","import initialState from '../store/initialState';\r\nimport * as types from '../actions/actionTypes';\r\n\r\nexport default function activeCommandReducer(state = initialState.activeCommand, action) {\r\n  switch (action.type) {\r\n    \r\n    case types.SET_ACTIVE_COMMAND:\r\n      return action.payload;\r\n    \r\n    // when addCommand is called, set that command to active\r\n    case types.ADD_COMMAND:\r\n      return action.payload.id;\r\n    \r\n    case types.REMOVE_COMMAND: {\r\n      return (action.payload.id === state) ? null : state;\r\n    }\r\n\r\n    case types.COPY_COMMAND: {\r\n      return action.payload.id;\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}","import initialState from '../store/initialState';\r\nimport * as types from '../actions/actionTypes';\r\n\r\nexport default function drawingModeReducer(state = initialState.drawingMode, action) {\r\n  switch (action.type) {\r\n    \r\n    case types.SET_DRAWING_MODE:\r\n      return action.payload;\r\n\r\n    case types.SET_ACTIVE_COMMAND:\r\n      return 'EDIT_POINTS';\r\n    \r\n    case types.ADD_COMMAND:\r\n      return 'ADD_POINTS';\r\n    \r\n    default:\r\n      return state;\r\n  }\r\n}","import initialState from '../store/initialState';\r\nimport * as types from '../actions/actionTypes';\r\n\r\nexport default function modalReducer(state = initialState.modalOpen, action) {\r\n  switch (action.type) {\r\n    \r\n    case types.OPEN_MODAL:\r\n      return true;\r\n\r\n    case types.CLOSE_MODAL:\r\n      return false;\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}","import { createStore } from 'redux';\r\nimport rootReducer from '../reducers/index';\r\nimport initialState from './initialState';\r\n\r\nexport default createStore(\r\n  rootReducer,\r\n  initialState,\r\n  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()\r\n);","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './components/App';\nimport * as serviceWorker from './serviceWorker';\nimport { Provider } from 'react-redux';\nimport store from './store';\n\nconst rootElement = document.getElementById('root');\n\nReactDOM.render((\n  <Provider store={store}>\n    <App />\n  </Provider>\n  ), rootElement);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}